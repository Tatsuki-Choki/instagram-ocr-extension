<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instagram OCR</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Instagram OCR</h1>
    </header>

    <!-- APIキー設定 -->
    <section id="api-key-section" class="section">
      <div class="section-header">
        <div class="label-with-link">
          <label for="api-key">Gemini API Key</label>
          <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener" class="api-key-link">取得はこちら</a>
        </div>
        <button id="toggle-key" class="btn-icon" title="表示/非表示">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </button>
      </div>
      <div class="input-group">
        <input type="password" id="api-key" placeholder="APIキーを入力">
        <button id="save-key" class="btn-primary">保存</button>
      </div>
      <p id="key-status" class="status hidden"></p>
    </section>

    <!-- メイン操作 -->
    <section id="main-section" class="section">
      <div id="not-instagram" class="notice hidden">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>Instagramの投稿ページで使用してください</span>
      </div>

      <!-- 読み取り設定 -->
      <div class="setting-group">
        <label for="reading-direction">読み取り方向</label>
        <select id="reading-direction">
          <option value="auto" selected>自動で判断</option>
          <option value="horizontal">横書き</option>
          <option value="vertical">縦書き</option>
        </select>
      </div>

      <button id="start-ocr" class="btn-large" disabled>
        <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
        <span class="btn-text">文字起こしを開始</span>
      </button>

      <div id="progress" class="progress hidden">
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
        <p class="progress-text"><span id="progress-count">0/0</span></p>
      </div>
    </section>

    <!-- 結果表示 -->
    <section id="results-section" class="section hidden">
      <div class="results-header">
        <h2>画像の文字起こし</h2>
        <div class="header-buttons">
          <button id="copy-all" class="btn-secondary">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            <span>全てコピー</span>
          </button>
          <button id="clear-all" class="btn-secondary btn-danger">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            <span>クリア</span>
          </button>
        </div>
      </div>
      <div id="results-container"></div>
    </section>

    <!-- キャプション表示 -->
    <section id="caption-section" class="section hidden">
      <div class="results-header">
        <h2>キャプション</h2>
        <button id="copy-caption" class="btn-secondary">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          <span>コピー</span>
        </button>
      </div>
      <div id="caption-text" class="caption-text"></div>
    </section>

    <!-- エラー表示 -->
    <div id="error-message" class="error hidden"></div>

    <!-- デバッグログ（一番下に控えめに配置） -->
    <section id="debug-section" class="section-debug">
      <div class="debug-header">
        <button id="toggle-debug" class="btn-toggle-debug">
          <svg class="toggle-arrow" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
          <span>Debug</span>
        </button>
        <div class="debug-buttons">
          <button id="copy-log" class="btn-debug">Copy</button>
          <button id="clear-log" class="btn-debug">Clear</button>
        </div>
      </div>
      <div id="debug-log" class="collapsed"></div>
    </section>
  </div>

  <!-- トースト通知 -->
  <div id="toast" class="toast"></div>

  <script src="sidepanel.js"></script>
</body>
</html>
